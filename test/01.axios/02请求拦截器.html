<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <button id="btn1">按钮1</button>
    <button id="btn2">按钮2</button>
    <button id="btn3">按钮3</button>
  </body>

  <script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
  <script>
    const btn1 = document.getElementById("btn1");
    const btn2 = document.getElementById("btn2");
    const btn3 = document.getElementById("btn3");

    let token = "";

    const axiosInstance = axios.create({
      baseURL: "http://localhost:5000/api",
      timeout: 10000,
      headers: {
        //公共的请求头参数
      }
    });

    axiosInstance.interceptors.request.use(
      (config)=>{
        if(config.method === 'post'){
          config.headers['content-type'] = 'application/x-www-form-urlencoded';

          config.data = Object.keys(config.data).reduce((prev,key)=>{
            const value = config.data[key];
            return  prev + `&${key}=${value}`
          },'').substring(1);
          
        }
        if(token){
            config.headers.authorization = 'Bearer '+token
          }
        return config
      },
      (err)=>{
        return Promise.reject(err)
      }
    )

    btn1.onclick = function() {
      axiosInstance({
        method: "POST",
        url: "/login",
        // data:'username=admin&password=admin',
        data: {
          username: "admin",
          password: "admin"
        }
        // headers:{
        //   'content-type':'application/x-www-form-urlencoded'
        // }
      })
        .then(response => {
          if (response.data.status === 0) {
            console.log(response.data.data);
            token = response.data.data.token;
          } else {
            alert(response.data.msg);
          }
        })
        .catch(err => {
          console.log(err);
          alert("网络出错");
        });
    };
    btn2.onclick = function() {
      axiosInstance({
        method: "GET",
        url: "/category/get",
        // headers: {
        //   authorization: "Bearer " + token
        // }
      })
        .then(response => {
          if (response.data.status === 0) {
            console.log(response.data.data);
          } else {
            alert(response.data.msg);
          }
        })
        .catch(err => {
          console.log(err);
          alert("网络错误");
        });
    };
    btn3.onclick = function() {
      axiosInstance({
        method: "POST",
        url: "/category/add",
        // data: "categoryName=鼠标",
        data:{
          categoryName:'鼠标'
        }
        // headers: {
        //   "content-type": "application/x-www-form-urlencoded",
        //   authorization: "Bearer " + token
        // }
      })
        .then(response => {
          if (response.data.status === 0) {
            console.log(response.data.data);
          } else {
            alert(response.data.msg);
          }
        })
        .catch(err => {
          console.log(err);
          alert("网络出错");
        });
    };
  </script>
</html>
