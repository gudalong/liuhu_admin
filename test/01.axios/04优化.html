<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Document</title>
</head>

<body>
  <button id="btn1">按钮1</button>
  <button id="btn2">按钮2</button>
  <button id="btn3">按钮3</button>
</body>

<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
<script>
  const btn1 = document.getElementById("btn1");
  const btn2 = document.getElementById("btn2");
  const btn3 = document.getElementById("btn3");

  let token = "";

  const axiosInstance = axios.create({
    baseURL: "http://localhost:5000/api",
    timeout: 10000,
    headers: {
      //公共的请求头参数
    }
  });

  //请求拦截器，
  axiosInstance.interceptors.request.use(
    (config) => {
      if (config.method === 'post') {
        config.headers['content-type'] = 'application/x-www-form-urlencoded';

        config.data = Object.keys(config.data).reduce((prev, key) => {
          const value = config.data[key];
          return prev + `&${key}=${value}`
        }, '').substring(1);

      }
      if (token) {
        config.headers.authorization = 'Bearer ' + token
      }
      return config
    },
    // (err)=>{
    //   return Promise.reject(err)
    // }
  )

  //响应拦截器
  axiosInstance.interceptors.response.use(
    (response) => {
      if (response.data.status === 0) {
        return (response.data.data)
      } else {
        alert(response.data.msg);
        return Promise.reject(response.data.msg)
      }
    },
    (error) => {
      const codeMessage = {
        401: '没有权限访问',
        403: '禁止访问',
        404: '资源不存在',
        500: '发生故障了，请联系管理员'
      };
      let errorMessage = ''
      if (error.response) {
        errorMessage = codeMessage[error.response.status]
      } else {
        if (error.message.indexof('Network Error') !== -1) {
          errorMessage = '网络连接异常~请检查网络连接'
        } else if (error.message.indexof('timeout') !== -1) {
          errorMessage = '请求连接超时，请移步到网络通畅地区'
        } else {
          errorMessage = '未知错误'
        }
      }
      alert(errorMessage)
      return Promise.reject(errorMessage)
    }
  )


  //登录请求函数
  const reqLogin = (username, password) => {
    return axiosInstance({
      method: "POST",
      url: "/login",
      data: {
        username,
        password
      }
    })
  }

  //获取列表请求函数
  const reqGetLogin = () => {
    return axiosInstance({
      method: "GET",
      url: "/category/get",
    })
  }

  //添加列表请求函数
  const reqAddLogin = (categoryName) => {
    return axiosInstance({
      method: "POST",
      url: "/category/add",
      data: {
        categoryName
      }
    })
  }

  btn1.onclick = function () {
    reqLogin('admin','admin')
      .then(response => {
        console.log(response);
        token = response.token;
      })
  };

  btn2.onclick = function () {
    reqGetLogin()
      .then(response => {
        console.log(response);
      })
  };

  btn3.onclick = function () {
    reqAddLogin('鼠标')
      .then(response => {
        console.log(response);
      })
  };
</script>

</html>